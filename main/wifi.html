<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ESP32 WiFi é…ç½‘</title>

<style>
body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont;
    background: #f2f3f5;
    padding: 20px;
}

.card {
    max-width: 420px;
    margin: auto;
    background: #ffffff;
    border-radius: 14px;
    padding: 22px;
    box-shadow: 0 8px 24px rgba(0,0,0,0.12);
    box-sizing: border-box;
}

h2 {
    text-align: center;
    margin-bottom: 18px;
}

label {
    margin-top: 14px;
    display: block;
    font-weight: 600;
    font-size: 14px;
    color: #333;
}

input,
select,
button {
    width: 100%;
    padding: 12px;
    margin-top: 6px;
    border-radius: 10px;
    border: 1px solid #d0d0d0;
    font-size: 15px;
    box-sizing: border-box;
    background-color: #ffffff;
    color: #333;
}

/* ===== ç»Ÿä¸€èšç„¦æ€ ===== */
input:focus,
select:focus {
    outline: none;
    border-color: #1677ff;
    box-shadow: 0 0 0 2px rgba(22,119,255,0.15);
}

/* ===== Select ä¸‹æ‹‰æ¡†ä¸»é¢˜åŒ– ===== */
select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;

    padding-right: 42px;

    background-image:
        linear-gradient(45deg, transparent 50%, #666 50%),
        linear-gradient(135deg, #666 50%, transparent 50%),
        linear-gradient(to right, #e5e5e5, #e5e5e5);

    background-position:
        calc(100% - 20px) calc(50% - 3px),
        calc(100% - 15px) calc(50% - 3px),
        calc(100% - 40px) 50%;

    background-size:
        6px 6px,
        6px 6px,
        1px 24px;

    background-repeat: no-repeat;
}

/* ä¸‹æ‹‰é€‰é¡¹é¢œè‰²ï¼Œé˜²æ­¢é»‘åº• */
option {
    color: #333;
    background-color: #ffffff;
}

/* ===== æŒ‰é’®æ ·å¼ ===== */
button {
    margin-top: 18px;
    background: linear-gradient(135deg, #1677ff, #4096ff);
    color: #fff;
    border: none;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
}

button:active {
    transform: scale(0.98);
}

button.secondary {
    margin-top: 10px;
    background: #f5f5f5;
    color: #333;
    border: 1px solid #ccc;
    font-size: 14px;
}

button.secondary:hover {
    background: #ebebeb;
}

/* ===== çŠ¶æ€æç¤º ===== */
.status {
    margin-top: 12px;
    font-size: 13px;
    color: #666;
    text-align: center;
}
</style>
</head>

<body>
<div class="card">
    <h2>ESP32 WiFi é…ç½‘</h2>

    <label>é€‰æ‹© WiFi</label>
    <select id="wifiList" onchange="selectSSID()">
        <option>æ­£åœ¨æ‰«æ...</option>
    </select>

    <button class="secondary" onclick="scanWifi()">ğŸ”„ é‡æ–°æ‰«æ</button>

    <label>SSID</label>
    <input id="ssid" placeholder="è‡ªåŠ¨å¡«å…¥æˆ–æ‰‹åŠ¨è¾“å…¥">

    <label>å¯†ç </label>
    <input id="password" type="password" placeholder="WiFi å¯†ç ">

    <button onclick="submit()">è¿æ¥ WiFi</button>

    <div class="status" id="status"></div>
</div>

<script>
function setStatus(msg) {
    document.getElementById('status').innerText = msg;
}

function scanWifi() {
    setStatus("æ­£åœ¨æ‰«æé™„è¿‘ WiFi...");
    fetch('/scan')
        .then(r => r.json())
        .then(list => {
            const sel = document.getElementById('wifiList');
            sel.innerHTML = '';
            if (list.length === 0) {
                const opt = document.createElement('option');
                opt.text = 'æœªå‘ç° WiFi';
                sel.appendChild(opt);
                setStatus("æœªæ‰«æåˆ° WiFi");
                return;
            }
            list.forEach(ap => {
                const opt = document.createElement('option');
                opt.value = ap.ssid;
                opt.text = ap.ssid + ' (' + ap.rssi + ' dBm)';
                sel.appendChild(opt);
            });
            document.getElementById('ssid').value = list[0].ssid;
            setStatus("æ‰«æå®Œæˆï¼Œå…±å‘ç° " + list.length + " ä¸ª WiFi");
        })
        .catch(() => {
            setStatus("æ‰«æå¤±è´¥ï¼Œè¯·é‡è¯•");
        });
}

function selectSSID() {
    document.getElementById('ssid').value =
        document.getElementById('wifiList').value;
}

function submit() {
    if (!ssid.value) {
        alert("SSID ä¸èƒ½ä¸ºç©º");
        return;
    }
    setStatus("å·²æäº¤ï¼Œè®¾å¤‡æ­£åœ¨è¿æ¥ WiFi...");
    fetch('/save', {
        method: 'POST',
        headers: {'Content-Type':'application/x-www-form-urlencoded'},
        body: 'ssid=' + encodeURIComponent(ssid.value) +
              '&password=' + encodeURIComponent(password.value)
    });
}

window.onload = scanWifi;
</script>
</body>
</html>
